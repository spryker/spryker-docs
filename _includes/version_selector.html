{% assign current_version = page.version | default: site.version %}
{% assign current_version_label = site.versions[current_version] | default: 'undefined' %}

{% assign total_versions = site.versions | size %}
{% if total_versions > 1 %}
  {%- comment -%}
  Strip the first path segment (current_version) from the page URL
  Example: /202404.0/guide/setup.html â†’ /guide/setup.html
  {%- endcomment -%}
  {% assign url_parts = page.url | split: '/' %}
  {% assign sliced_url_parts = url_parts | slice: 2, url_parts.size %}
  {% assign cleaned_url = '/' | append: sliced_url_parts | join: '/' %}

  <div class="alt-nav dropdown">
    <span class="alt-nav__opener nav-link dropdown-toggle" id="versionDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <span class="alt-nav__opener-text">{{ current_version_label }}</span>
      <i class="alt-nav__opener-icon icon-arrow-down"></i>
    </span>
    <span class="alt-nav__opener-label">Versions</span>
    <ul class="alt-nav__drop dropdown-menu" aria-labelledby="versionDropdownMenuLink">
      {% for version_key in site.versions %}
        {% assign version_label = site.versions[version_key] %}
        <li>
          <a href="{{ site.baseurl }}/{{ version_key }}{{ cleaned_url }}">{{ version_label }}</a>
        </li>
      {% endfor %}
    </ul>
  </div>
  <div class="alt-nav__overlay"></div>
{% else %}
  <div class="alt-nav">
    <span class="alt-nav__opener">This document has only one version {{ current_version_label }}</span>
  </div>
{% endif %}
